# task-014-mikrotik-safe-file-remove.md

## Мета
Виправити механізм видалення файлів на MikroTik, замінивши небезпечне використання
```
/file remove <filename>
```
на **коректний і стабільний варіант** з використанням `find`:

```
/file remove [find name="<filename>"]
```

Це необхідно для коректної роботи з іменами файлів, які містять спецсимволи
(`-`, `_`, `.`, `:`), зокрема для binary backup-файлів з timestamp у назві.

---

## Контекст
Під час виконання cleanup binary backup було зафіксовано помилку:

```
expected end of command (line 1 column X)
```

Причина:
- MikroTik CLI не екранує аргументи як POSIX shell
- пряме передавання імені файлу призводить до синтаксичної помилки

---

## Вимоги

### 1) Заміна команди видалення
У всіх місцях коду, де виконується видалення файлів з MikroTik:

❌ Заборонено:
```
/file remove <filename>
```

✅ Обовʼязково використовувати:
```
/file remove [find name="<filename>"]
```

---

### 2) Область змін
Перевірити та оновити (за потреби):

- `src/app/mikrotik/client.py`
- `src/app/mikrotik/backup.py`
- будь-які helper-функції, що виконують file cleanup

У коді **не повинно залишитись** прямого видалення файлів за іменем без `find`.

---

### 3) Поведінка при відсутності файлу
Якщо файл не знайдено:

- команда `/file remove [find name="..."]` не видалить нічого
- це **не повинно вважатись помилкою**
- логувати можна на рівні DEBUG або INFO

---

## Логування

### Успішне видалення
```
INFO remote file removed filename=<filename>
```

### Файл не знайдено
```
DEBUG remote file not found, nothing to remove filename=<filename>
```

### Помилка виконання команди
```
WARNING failed to remove remote file filename=<filename> error=<message>
```

---

## Реалізація в коді

### Рекомендований підхід
Інкапсулювати видалення файлу в одну функцію, наприклад:

```python
def remove_remote_file(filename: str) -> None:
    ...
```

Всередині:
- формувати команду **лише** через `find`
- не екранувати імʼя вручну
- не падати, якщо файл відсутній

---

## Acceptance criteria
- У коді відсутні виклики `/file remove <filename>`
- Усі видалення виконуються через `find name="..."`
- Видалення файлів з timestamp у назві працює стабільно
- Backup-процес не падає, якщо файл вже відсутній

---

## Результат
NetConfigBackup використовує безпечний, стабільний та ідемпотентний механізм
видалення файлів на MikroTik, сумісний з будь-якими іменами файлів.
