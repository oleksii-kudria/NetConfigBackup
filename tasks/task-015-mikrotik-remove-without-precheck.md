# task-015-mikrotik-remove-without-precheck.md

## Мета
Виправити логіку очищення файлів на MikroTik шляхом **повного видалення попередньої перевірки існування файлу** та виконання команди видалення **без pre-check**.

Основний принцип:  
> `/file remove [find name="..."]` є безпечною та ідемпотентною командою і не потребує попередньої перевірки.

---

## Контекст
У попередній реалізації Codex додав перевірку існування файлу через команду:

```
/file find name="<filename>"
```

Проблеми цього підходу:
- команда `find` не повертає стабільний stdout для парсингу через SSH
- у результаті код помилково вважає, що файл відсутній
- cleanup не виконується, хоча файл реально існує
- порушується логіка binary-backup cleanup

---

## Рішення (обраний варіант)

### ❌ Прибрати pre-check
Повністю **видалити** логіку:
- виконання `/file find ...`
- умовні гілки, що залежать від результату `find`
- ранній `return`, який блокує `remove`

### ✅ Виконувати remove одразу
Завжди виконувати команду:

```
/file remove [find name="<filename>"]
```

Ця команда:
- безпечна
- не генерує помилку, якщо файл відсутній
- працює з будь-якими іменами файлів (timestamps, спецсимволи)
- підходить для автоматизації

---

## Логування

### Обовʼязкове логування
Після виконання команди видалення:

```
INFO remote file cleanup requested filename=<filename>
```

### Опційне (DEBUG)
За потреби дозволено виконати **post-check** через:

```
/file print count-only where name="<filename>"
```

і логувати:
- файл видалений
- файл був відсутній
- файл не видалився (warning)

Pre-check **не використовується**.

---

## Область змін
Перевірити та оновити:

- `src/app/mikrotik/client.py`
- `src/app/mikrotik/backup.py`
- будь-які helper-функції, повʼязані з cleanup remote files

У коді **не повинно залишитись** логіки перевірки існування файлу через `find`.

---

## Acceptance criteria
- Відсутні виклики `/file find name="..."`
- Cleanup виконується через `/file remove [find name="..."]`
- Cleanup не блокується через “файл не знайдено”
- Backup-процес не падає, якщо файл вже відсутній
- Логи коректно відображають факт запиту на cleanup

---

## Результат
NetConfigBackup використовує просту, надійну та ідемпотентну модель очищення файлів на MikroTik без помилкових перевірок існування, що усуває false-negative сценарії та підвищує стабільність backup-процесу.
