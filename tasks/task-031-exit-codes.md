# task-031-exit-codes.md

## Мета
Додати **коректні exit codes** для `scripts/run.py`, щоб інтеграції (cron/CI) могли надійно визначати результат запуску.

---

## Вимоги

### 1) Exit code policy
Запровадити наступні коди завершення:

- `0` - успіх
  - усі пристрої/задачі, які мали виконуватись, виконані без помилок
- `1` - частковий успіх (partial failure)
  - хоча б один пристрій/задача впала
  - але хоча б один пристрій успішно оброблено
- `2` - повний провал (critical failure)
  - не вдалось успішно виконати жоден бекап/жодну вибрану задачу
  - або критична помилка конфігів (неможливо прочитати `devices.yml`, `secrets.yml` тощо)

Dry-run:
- якщо всі перевірки підключень успішні => `0`
- якщо є часткові невдачі => `1`
- якщо всі невдалі або конфіг критично зламаний => `2`

---

### 2) Критерії “success”
Під “success” розуміємо:
- у звичайному режимі: хоча б один backup файл реально створений (для вибраних feature flags)
- у dry-run: хоча б один пристрій пройшов SSH login

Важливо:
- при запуску з feature flags (task-027) “успіх” рахується лише по вибраних задачах.

---

### 3) Реалізація
- `scripts/run.py` має завершуватись через `sys.exit(<code>)`
- код визначається на основі run summary (task-030) або внутрішніх лічильників

---

### 4) Логування
Після завершення run:
- INFO: `exit_code=<0|1|2>`

---

### 5) Документація (README.md)
Оновити README (UA + EN):
- описати exit codes 0/1/2
- навести приклади сценаріїв

---

## Область змін
- `scripts/run.py`
- README.md

---

## Acceptance criteria
- `scripts/run.py` повертає 0/1/2 відповідно до policy
- повний провал повертає 2
- часткові помилки повертають 1
- успішний run повертає 0
- README.md містить опис exit codes
