# task-016-mikrotik-binary-backup-filename-device-based.md

## Мета
Змінити схему іменування **бінарних backup-файлів MikroTik** таким чином, щоб імʼя файлу
містило **імʼя пристрою з конфігурації `devices.yml`**, а не лише timestamp і технічний суфікс.

Це підвищує:
- читабельність backup-архіву
- однозначну привʼязку файлу до пристрою
- зручність відновлення та ручного аналізу

---

## Контекст
Наразі binary backup створюється з іменем виду:

```
2025-12-28_121400_system.backup
```

Недоліки:
- з імені файлу неможливо зрозуміти, до якого пристрою він належить
- при зберіганні бекапів з кількох MikroTik можливі колізії або плутанина
- складніше працювати з файлами поза контекстом директорії

---

## Нова схема іменування

### Формат
```
<device_name>_<YYYY-MM-DD_HHMMSS>.backup
```

### Приклад
Для пристрою з `config/devices.yml`:

```yml
- vendor: mikrotik
  name: main-mikrotik
```

Бінарний backup-файл має назву:
```
main-mikrotik_2025-12-28_121400.backup
```

---

## Вимоги

### 1) Джерело імені пристрою
- `device_name` береться **виключно** з `config/devices.yml`
- використовується поле `name`
- імʼя не модифікується (без транслітерації, snake_case тощо)

---

### 2) Використання імені в backup-процесі
Нове імʼя файлу повинно використовуватись послідовно у всіх кроках:

- `/system backup save name=<device_name>_<timestamp>`
- завантаження binary backup з пристрою
- локальне збереження файлу
- cleanup файлу на MikroTik (`/file remove [find name="..."]`)
- логування

⚠️ У команді `/system backup save` **НЕ додавати** розширення `.backup`
(воно додається RouterOS автоматично).

---

### 3) Валідація імені
- імʼя файлу не повинно містити пробілів
- символи `-` та `_` дозволені
- додаткове екранування **не потрібне**, оскільки видалення виконується через `find`

---

### 4) Логування
У логах повинно бути чітко видно:

- імʼя пристрою
- згенероване імʼя backup-файлу

Приклад:
```
INFO creating system-backup device=main-mikrotik filename=main-mikrotik_2025-12-28_121400.backup
```

---

## Область змін
Перевірити та оновити (за потреби):

- `src/app/mikrotik/backup.py`
- `src/app/mikrotik/client.py`
- допоміжні функції формування імен файлів

У коді **не повинно залишитись** жорстко закодованого суфікса `_system.backup`.

---

## Acceptance criteria
- Імʼя binary backup-файлу містить імʼя пристрою з `devices.yml`
- Формат відповідає `<device_name>_<timestamp>.backup`
- Backup, download і cleanup працюють з новим іменем
- Логи відображають нову схему іменування
- Колізії між пристроями виключені

---

## Результат
NetConfigBackup використовує зрозумілу, стабільну та масштабовану схему
іменування binary backup-файлів MikroTik з привʼязкою до імені пристрою.
