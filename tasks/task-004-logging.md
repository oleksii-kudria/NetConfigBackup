# task-004-logging.md

## Мета
Реалізувати централізоване логування для проєкту **NetConfigBackup** з можливістю керування шляхом збереження логів через окремий конфігураційний файл.

Логування має бути стабільним, інформативним та безпечним (без витоку секретів).

---

## Загальні вимоги
- Логи пишуться у файл
- Шлях до логів задається через конфігураційний файл
- За замовчуванням використовується `/var/log/netconfigbackup/`
- Якщо немає прав на запис — використовується fallback директорія
- Паролі та секрети **ніколи не логуються**

---

## Конфігураційний файл логування

### Файл
- `config/logging.yml`

### Формат
```yml
logging:
  directory: /var/log/netconfigbackup
  filename: netconfigbackup.log
  level: INFO
```

### Пояснення
- `directory` — директорія для зберігання логів
- `filename` — імʼя лог-файлу
- `level` — рівень логування (`DEBUG`, `INFO`, `WARNING`, `ERROR`)

> Файл `logging.yml` **не містить чутливих даних** та може зберігатися в git.

---

## Файли для реалізації

- `config/logging.yml`
- `src/app/core/logging.py`
- (оновлення) `scripts/run.py`

---

## Вимоги до логування

### Формат лог-запису
```
YYYY-mm-dd HH:MM:SS | LEVEL | device=<device_name|-> | message
```

### Обовʼязкові події
- старт виконання скрипту
- завершення виконання скрипту
- початок обробки кожного пристрою
- успішне завершення бекапу для пристрою
- помилки (з traceback, але без секретів)

---

## Поведінка при помилках

- Якщо директорія з логами не існує — спробувати створити
- Якщо немає прав на запис:
  - зафіксувати warning
  - використовувати fallback `./logs/`
- Якщо конфіг `logging.yml` відсутній:
  - використовувати дефолтні значення

---

## Реалізація в коді

### `src/app/core/logging.py`
- Завантаження `config/logging.yml`
- Ініціалізація `logging.Logger`
- Функція:
```python
def setup_logging(config_path: str | None = None) -> logging.Logger:
    ...
```

---

## Інтеграція

### `scripts/run.py`
- Виклик `setup_logging()` на старті
- Передача logger у всі модулі
- Використання `device=<name>` у логах

---

## Вимоги до .gitignore
Переконатися, що виключено:
```
logs/
*.log
```

---

## Критерії приймання
- Логи створюються у директорії з `logging.yml`
- Працює fallback при відсутності прав
- Формат логів відповідає вимогам
- Паролі не зʼявляються в логах
- Рівень логування керується через конфіг

---

## Результат
NetConfigBackup має кероване, передбачуване та безпечне логування, придатне для тривалого використання на Ubuntu-системах та серверному середовищі.
